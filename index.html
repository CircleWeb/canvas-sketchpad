<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>canvas画板</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <canvas id="sketchpad" width="500" height="500"></canvas>
    <div id="toolDiv" class="action">
        <button id="eraser">橡皮擦</button>
        <button id="brush">画笔</button>
    </div>

    <script>
        var canvas = document.getElementById('sketchpad')
        var context = canvas.getContext('2d')            

        autoSetCanvasSize(canvas)

        listenToMouse(canvas)

        /* 切换画笔、橡皮擦 */
        var erasering = false;
        eraser.onclick = function(e) {
            erasering = true
            toolDiv.className = 'action x'
        }

        brush.onclick = function() {
            erasering = false
            toolDiv.className = 'action'
        }

        function drawCircle(x, y) {
            context.beginPath()
            context.arc(x, y, 3, 0, Math.PI*2)
            context.fillStyle = 'red'
            context.fill()
        }
        
        function drawLine(lastPointer, newPointer) {
            context.beginPath()
            context.moveTo(lastPointer.x, lastPointer.y)
            context.lineTo(newPointer.x, newPointer.y)
            context.lineWidth = 6
            context.strokeStyle = 'red'
            context.stroke()
            context.closePath()
        }

        function autoSetCanvasSize(canvas) {

            setCanvasSize()
            
            window.onresize = function() {
                setCanvasSize()
            }

            function setCanvasSize() {
                var pWidth = document.documentElement.clientWidth;
                var pHeight = document.documentElement.clientHeight;
                canvas.width = pWidth
                canvas.height = pHeight
                
                pWidth = document.documentElement.clientWidth;
                pHeight = document.documentElement.clientHeight;
                canvas.width = pWidth
                canvas.height = pHeight
            }
        }

        function listenToMouse(canvas) {
            var painting = false;
            var lastPointer = {'x': undefined, 'y': undefined }
            
            canvas.onmousedown = function(a) {
                painting = true;
                var x = a.clientX;
                var y = a.clientY;
                lastPointer = { x: x, y: y }

                if(erasering) {
                    context.clearRect(x-5, y-5, 10, 10)
                }else {
                    drawCircle(x, y)
                }
            }

            canvas.onmousemove = function(a) {
                if(painting) {
                    var x = a.clientX;
                    var y = a.clientY;
                    var newPointer = { x: x, y: y }
                    
                    if(erasering) {
                        context.clearRect(x-5, y-5, 10, 10)
                    }else {
                        
                        drawCircle(x, y)
                        drawLine(lastPointer, newPointer)

                    }

                    lastPointer = newPointer
                }
            }
            
            document.onmouseup = function() {
                painting = false
            }
        }
    </script>
</body>
</html>